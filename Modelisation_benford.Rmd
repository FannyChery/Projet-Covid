---
title: "Projet fraudes covid"
author: "LUCEA Lenny"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# BENFORD 6eme VAGUE COVID

exemple data france ancienne données

```{r}
#-------------------- chargement data -------------------
library(data.table)
df <- read.csv("datafrance.csv")
data.table(df)
dfdonn <- df[,c("cas", "deces", "guerisons")]
x <- c(df$cas,df$deces,df$guerisons)
```


```{r}
benlaw <- function(d) log10(1 + 1 / d)
digits <- 1:9
firstDigit <- function(x) substr(gsub('[0.]', '', x), 1, 1)
pctFirstDigit <- function(x) data.frame(table(firstDigit(x)) / length(x))
df <- pctFirstDigit(x)
baseBarplot <- barplot(df$Freq[1:9],names.arg = digits,  xlab = "First Digit", ylim = c(0, .35),col="blue")
lines(y=benlaw(digits), x = baseBarplot[,1], col = "red", lwd = 4, 
      type = "b", pch = 23, cex = 1.5, bg = "red")
legend(x="topright", legend=c("Benford distribution"),
       col=c("red"), lty=1,lwd=4, cex=0.8)

```

```{r}
#-------------------------- tests benford -------------------------------
library(BenfordSmoothTest)
chisq.benftest(x) # test du khi-deux
edist.benftest(x) # test distance euclidienne
jointdigit.benftest(x) # ???
jpsq.benftest(x) # un test d'adéquation basé sur la corrélation entre la distribution des premiers chiffres et la distribution de Benford
ks.benftest(x) # smirnov
mdist.benftest(x) # chebyshev
usq.benftest(x) # Freedman-Watson
BenfordSmooth.test(x)
```


Place au vif du sujet !


```{r}
library(data.table)
library(dplyr)
df <-read.csv("corona_comp.csv", sep= ";", header= T)
dfa <- data.table(df)
distinct(dfa,dfa$Pays)
```

```{r}
dfac <- dfa[,c("Infections", "Deces", "Guerisons")]
```

```{r}
# fonction plot :
benf <- function(df){
  x <- c(df$Infection,df$Deces,df$Guerisons)
  x <- x[x!=0]
  signifd.analysis(x)
}
```

```{r}
dfachine <- dfa[dfa$Pays=="Taïwan",]
dfaMA <- dfa[dfa$Pays=="Martinique",]
dfaGua <- dfa[dfa$Pays=="Guadeloupe",]
dfajap <- dfa[dfa$Pays=="Japon",]
dfaukr <- dfa[dfa$Pays=="Ukraine",]
dfafr <- dfa[dfa$Pays=="France",]
dfaQa <- dfa[dfa$Pays=="Qatar"]
benf(dfachine)
benf(dfaMA)
benf(dfafr)
```


```{r}
library(dplyr)
library(data.table)
read.csv("covid6.csv",sep=",",header=T)
b <- data.table(b)
distinct(b,b$location)
b <- b[b$date > "2021-12-01",]
drop_na(b)
# on commence à partir de septembre 2021 on s'intéresses aux données récentes.
```

```{r}
vec <- function(df){
  x <- c(df$new_cases,df$new_deaths,df$hosp_patients)
  x <- x[x!=0]
  j=1
  for(i in 1:length(x)){
  if(is.na(x[j])){
    x <- x[-j]
  }
  else{
    j <- j +1
  }
  }
  return(x)
}
benf <- function(dd){
x <- vec(dd)
benlaw <- function(d) log10(1 + 1 / d)
digits <- 1:9
firstDigit <- function(x) substr(gsub('[0.]', '', x), 1, 1)
pctFirstDigit <- function(x) data.frame(table(firstDigit(x)) / length(x))
df <- pctFirstDigit(x)
if(length(x)==0){
  return()
}
else{
baseBarplot <- barplot(df$Freq[1:9], names.arg = digits, xlab = "First Digit",ylab="frequency", ylim = c(0, .35),col="blue",main=dd$location[1])
lines(x = baseBarplot[,1], y = benlaw(digits), col = "red", lwd = 4, 
      type = "b", pch = 23, cex = 1.5, bg = "red")
legend(x="topright", legend=c("Benford distribution"),
       col=c("red"), lty=1,lwd=4, cex=0.8)
}
}
```



```{r, warning=F}
library(tidyr)
library(dplyr)
library(BenfordTests)
name <- distinct(b,b$location)
x <- as.vector(name$`b$location`)
c <- x[1:49]
d <- x[120:308]
x <- c(c,d)
for(i in 1:length(x)){
  bq <- b[b$location==x[i],]
  benf(bq)
} 
```

```{r}
#______________________ pas vraiment exploitable on ne voit pas les noms ________
name <- distinct(b,b$location)
x <- as.vector(name$`b$location`)
for(i in 1:length(x)){
  bq <- b[b$location==x[i],]
  c <- c(bq$new_cases,bq$new_deaths,bq$hosp_patients)
  c <- c[c!=0]
  print(x[i])
  signifd.analysis(c)
} 
```

```{r}
#_____________________________ comparaison des tests ______________________________
ks <- function(df){
  x<-vec(df)
  if(length(x)==0){
    return()
  }
  z <- chisq.benftest(x)
  return(z)
}
sm <- function(df){
  x<-vec(df)
  if(length(x)==0){
    return()
  }
  y <- ks.benftest(x)
  return(y)
}
ks <- function(df){
  x<-vec(df)
  if(length(x)==0){
    return()
  }
  z <- chisq.benftest(x)
  return(z)
}
```

