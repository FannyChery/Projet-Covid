---
title: "Projet fraudes covid"
author: "LUCEA Lenny"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# BENFORD 6eme VAGUE COVID

exemple data france ancienne données

```{r}
#-------------------- chargement data -------------------
library(data.table)
df <- read.csv("datafrance.csv")
data.table(df)
dfdonn <- df[,c("cas", "deces", "guerisons")]
x <- c(df$cas,df$deces,df$guerisons)
```


```{r}
par(mfrow=c(1,2))
benlaw <- function(d) log10(1 + 1 / d)
digits <- 1:9
firstDigit <- function(x) substr(gsub('[0.]', '', x), 1, 1)
pctFirstDigit <- function(x) data.frame(table(firstDigit(x)) / length(x))
df <- pctFirstDigit(x)
baseBarplot <- barplot(benlaw(digits), names.arg = digits, xlab = "First Digit", 
                       ylim = c(0, .35),col="blue")
lines(x = baseBarplot[,1], y = df$Freq, col = "red", lwd = 4, 
      type = "b", pch = 23, cex = 1.5, bg = "red")
```

```{r}
#-------------------------- tests benford -------------------------------
library(BenfordSmoothTest)
chisq.benftest(x) # test du khi-deux
edist.benftest(x) # test distance euclidienne
jointdigit.benftest(x) # ???
jpsq.benftest(x) # un test d'adéquation basé sur la corrélation entre la distribution des premiers chiffres et la distribution de Benford
ks.benftest(x) # smirnov
mdist.benftest(x) # chebyshev
usq.benftest(x) # Freedman-Watson
BenfordSmooth.test(x)
```


Place au vif du sujet !


```{r}
library(data.table)
library(dplyr)
df <-read.csv("corona_comp.csv", sep= ";", header= T)
dfa <- data.table(df)
distinct(dfa,dfa$Pays)
```

```{r}
dfac <- dfa[,c("Infections", "Deces", "Guerisons")]
```

```{r}
# fonction plot :
benf <- function(df){
  x <- c(df$Infection,df$Deces,df$Guerisons)
  x <- x[x!=0]
  signifd.analysis(x)
}
```

```{r}
dfachine <- dfa[dfa$Pays=="Taïwan",]
dfaMA <- dfa[dfa$Pays=="Martinique",]
dfaGua <- dfa[dfa$Pays=="Guadeloupe",]
dfajap <- dfa[dfa$Pays=="Japon",]
dfaukr <- dfa[dfa$Pays=="Ukraine",]
dfafr <- dfa[dfa$Pays=="France",]
dfaQa <- dfa[dfa$Pays=="Qatar"]
benf(dfachine)
benf(dfaMA)
benf(dfafr)
```
```{r}
library(RCurl)
a <- getURL('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv')
b = read.table(text=a, sep=",", header = TRUE)
```

```{r}
library(dplyr)
library(data.table)
b <- data.table(b)
distinct(b,b$location)
b <- b[b$date > "2021-12-01",]
drop_na(b)
# on commence à partir de septembre 2021 on s'intéresses aux données récentes.
```
```{r}
benf <- function(dd){
x <- c(dd$new_cases,dd$new_deaths,dd$hosp_patients)
x <- x[x!=0]

benlaw <- function(d) log10(1 + 1 / d)
digits <- 1:9
firstDigit <- function(x) substr(gsub('[0.]', '', x), 1, 1)
pctFirstDigit <- function(x) data.frame(table(firstDigit(x)) / length(x))
df <- pctFirstDigit(x)
if(any(1==df)==F| any(2==df)==F | any(3==df)==F | any(4==df)==F | any(5==df)==F| any(6==df)==F | any(7==df)==F | any(8==df)==F | any(9==df)==F){
  return("graphe non possible")
}
else{
baseBarplot <- barplot(benlaw(digits), names.arg = digits, xlab = "First Digit", 
                       ylim = c(0, .35),col="blue",main=dd$location[1])
lines(x = baseBarplot[,1], y = df$Freq, col = "red", lwd = 4, 
      type = "b", pch = 23, cex = 1.5, bg = "red")
}
}
```

```{r}
bq <- b[b$location=="Qatar",]
bn <- bq[,c("new_cases", "new_deaths", "hosp_patients","location")]
benf(bn)
```
```{r}
bq <- b[b$location=="France",]
bn <- bq[,c("new_cases", "new_deaths", "hosp_patients","location")]
benf(bn)
```
```{r}
bq <- b[b$location=="Russia",]
bn <- bq[,c("new_cases", "new_deaths", "hosp_patients","location")]
benf(bn)
```

```{r}
bq <- b[b$location=="United Arab Emirates",]
bn <- bq[,c("new_cases", "new_deaths", "hosp_patients","location")]
benf(bn)
```
```{r}

bq <- b[b$location=="United States",]
bn <- bq[,c("new_cases", "new_deaths", "hosp_patients","location")]
benf(bn)
```
```{r, warning=F}
library(tidyr)
library(BenfordTests)
name <- distinct(b,b$location)
x <- as.vector(name$`b$location`)
c <- x[1:49]
d <- x[120:308]
x <- c(c,d)
for(i in 1:length(x)){
  bq <- b[b$location==x[i],]
  benf(bq)
} 
```

```{r}
name <- distinct(b,b$location)
x <- as.vector(name$`b$location`)
c <- x[1:49]
d <- x[120:308]
x <- c(c,d)
for(i in 1:length(x)){
  bq <- b[b$location==x[i],]
  c <- c(bq$new_cases,bq$new_deaths,bq$hosp_patients)
  c <- c[c!=0]
  signifd.analysis(c)
} 
```

